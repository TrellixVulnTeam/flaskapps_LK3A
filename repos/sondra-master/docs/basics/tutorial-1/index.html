<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Your first Sondra API - Sondra Documentation</title>
    <meta name="generator" content="Hugo 0.17" />

    
    <meta name="description" content="A framework for creating rich APIs with Python and RethinkDB.">
    
    <link rel="canonical" href="https://jeffersonheard.github.io/sondra/basics/tutorial-1/">
    
    <meta name="author" content="Jefferson Heard">
    

    <meta property="og:url" content="https://jeffersonheard.github.io/sondra/basics/tutorial-1/">
    <meta property="og:title" content="Sondra Documentation">
    <meta property="og:image" content="https://jeffersonheard.github.io/sondra//img/sondra.svg">
    <meta name="apple-mobile-web-app-title" content="Sondra Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://jeffersonheard.github.io/sondra/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://jeffersonheard.github.io/sondra/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://jeffersonheard.github.io/sondra/fonts/icon.eot?52m981');
        src: url('https://jeffersonheard.github.io/sondra/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('https://jeffersonheard.github.io/sondra/fonts/icon.woff?52m981')
               format('woff'),
             url('https://jeffersonheard.github.io/sondra/fonts/icon.ttf?52m981')
               format('truetype'),
             url('https://jeffersonheard.github.io/sondra/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" href="https://jeffersonheard.github.io/sondra/stylesheets/application.css">
    <link rel="stylesheet" href="https://jeffersonheard.github.io/sondra/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://jeffersonheard.github.io/sondra/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://jeffersonheard.github.io/sondra/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://jeffersonheard.github.io/sondra/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-brown palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Your first Sondra API
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/jeffersonheard" title="@jeffersonheard on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/jeffersonheard" title="@jeffersonheard on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/jeffersonheard/sondra" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://jeffersonheard.github.io/sondra//img/sondra.svg">
        </div>
      
      <div class="name">
        <strong>Sondra Documentation <span class="version">1.0.0</span></strong>
        
          <br>
          jeffersonheard/sondra
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/jeffersonheard/sondra/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/jeffersonheard/sondra/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introduction" href="https://jeffersonheard.github.io/sondra/">
	
	Introduction
</a>



  
</li>



<li>
  
    <span class="section">Tutorial</span>
    <ul>
      
        
        



<a  title="Your first Sondra API" href="https://jeffersonheard.github.io/sondra/basics/tutorial-1/">
	
	Your first Sondra API
</a>



      
        
        



<a  title="Expose it to the Web" href="https://jeffersonheard.github.io/sondra/basics/tutorial-2/">
	
	Expose it to the Web
</a>



      
        
        



<a  title="Accessing Schemas" href="https://jeffersonheard.github.io/sondra/basics/tutorial-3/">
	
	Accessing Schemas
</a>



      
        
        



<a  title="Adding and Accessing Data" href="https://jeffersonheard.github.io/sondra/basics/tutorial-4/">
	
	Adding and Accessing Data
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Topical Guides</span>
    <ul>
      
        
        



<a  title="Output Formats" href="https://jeffersonheard.github.io/sondra/extending/output-formats/">
	
	Output Formats
</a>



      
        
        



<a  title="Request Processors" href="https://jeffersonheard.github.io/sondra/extending/request-processors/">
	
	Request Processors
</a>



      
        
        



<a  title="The Flask App" href="https://jeffersonheard.github.io/sondra/topical-guides/flask/">
	
	The Flask App
</a>



      
        
        



<a  title="Value Handlers" href="https://jeffersonheard.github.io/sondra/extending/value-handlers/">
	
	Value Handlers
</a>



      
        
        



<a  title="Working with Applications" href="https://jeffersonheard.github.io/sondra/topical-guides/applications/">
	
	Working with Applications
</a>



      
        
        



<a  title="Collections" href="https://jeffersonheard.github.io/sondra/topical-guides/collections/">
	
	Collections
</a>



      
        
        



<a  title="Documents" href="https://jeffersonheard.github.io/sondra/topical-guides/documents/">
	
	Documents
</a>



      
        
        



<a  title="Exposing Methods" href="https://jeffersonheard.github.io/sondra/topical-guides/methods/">
	
	Exposing Methods
</a>



      
        
        



<a  title="The Javascript Client" href="https://jeffersonheard.github.io/sondra/topical-guides/javascript/">
	
	The Javascript Client
</a>



      
        
        



<a  title="Queries over HTTP/S" href="https://jeffersonheard.github.io/sondra/topical-guides/querying/">
	
	Queries over HTTP/S
</a>



      
        
        



<a  title="QuerySets in Python" href="https://jeffersonheard.github.io/sondra/topical-guides/querysets/">
	
	QuerySets in Python
</a>



      
        
        



<a  title="Suites" href="https://jeffersonheard.github.io/sondra/topical-guides/suites/">
	
	Suites
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Extending</span>
    <ul>
      
        
        



<a  title="Document Processors" href="https://jeffersonheard.github.io/sondra/extending/document-processors/">
	
	Document Processors
</a>



      
    </ul>
  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/jeffersonheard" target="_blank" title="@jeffersonheard on Twitter">
              @jeffersonheard on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/jeffersonheard" target="_blank" title="@jeffersonheard on GitHub">
              @jeffersonheard on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:jefferson.r.heard@gmail.com" title="Email of jefferson.r.heard@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Your first Sondra API </h1>

			

<h3 id="introduction">Introduction</h3>

<p>This tutorial serves as a basic introduction to Sondra, its data model, and how you
can create an API. The classic example web API is that of a to-do list application. Our tutorial
will build it up in stages, starting with the basic structure of an application, followed by data
modeling, and then we&rsquo;ll add exposed methods to see how those work.</p>

<p>Finally, you&rsquo;ll work through accessing the API via Javascript (ES2015) and Python.</p>

<p>To do this tutorial, you will need the following installed and ready to go:</p>

<ul>
<li>Sondra - <a href="https://github.com/JeffHeard/sondra.git">https://github.com/JeffHeard/sondra.git</a></li>
<li>RethinkDB - <a href="https://rethinkdb.com">https://rethinkdb.com</a></li>
<li>Python 3 - <a href="https://www.python.org">https://www.python.org</a></li>
<li>Your favorite text editor or IDE. I like <a href="https://www.atom.io/">Atom</a></li>
</ul>

<h3 id="first-steps">First Steps</h3>

<p>First thing&rsquo;s first. Let&rsquo;s make sure Sondra has all its requirements.  Assuming you have a virtual
environment setup already, all you have to do is install requirements.</p>

<pre><code class="language-bash">$ cd sondra
$ pip install -r requirements.txt
$ export PYTHONPATH=$PYTHONPATH:$PWD  # if you want to develop in a different directory or run the examples.
</code></pre>

<p>Let&rsquo;s start with some imports.</p>

<pre><code class="language-python">from sondra.collection import Collection
from sondra.document import Document
from sondra.application import Application
from sondra.suite import Suite
from sondra.schema import S
</code></pre>

<p>These imports serve to introduce us to the basic building blocks of Sondra: Application, Collection,
and Document. We will subclass each to create our application.  The <strong>Document</strong> subclass defines
the schema of a record in <a href="https://rethinkdb.com/">RethinkDB</a> and all the methods that operate
directly on a record instance.</p>

<p>The <strong>Collection</strong> subclass defines the way a document relates to the database. It defines things
such as primary key and indexes and methods that operate on the collection as a whole. Methods
defined on the collection class are conceptually similar to class methods in Python.</p>

<p>The <strong>Application</strong> subclass defines a group of collections that serve a common purpose.  The
application will often contain schema fragment definitions that are common across multiple related
collections and methods that apply to multiple collections across the application.</p>

<p>The <strong>Suite</strong> subclass defines the complete API suite, including configurations and database
connections. Applications are added to the Suite.</p>

<p>Finally <strong>S</strong> is a utility module whose functions return dictionaries that fit the format of
<a href="http://json-schema.org/">JSON Schema</a> and hyper-schema.</p>

<h3 id="modeling-data">Modeling Data</h3>

<p>So let&rsquo;s start by creating a Document that models a to-do list item:</p>

<pre><code class="language-python">from sondra.collection import Collection
from sondra.document import Document
from sondra.application import Application
from sondra.suite import Suite
from sondra.schema import S

class Item(Document):
    schema = {
      &quot;type&quot;: &quot;object&quot;,
      &quot;required&quot;: [&quot;title&quot;],
      &quot;properties&quot;: {
        &quot;title&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;The title of the item&quot;},
        &quot;complete&quot; {&quot;type&quot;: &quot;boolean&quot;, &quot;default&quot;: False},
        &quot;created&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;format&quot;: &quot;date-time&quot;}
      }
    }
</code></pre>

<p>Now we&rsquo;ve defined a simple item that has a title, a space to mark whether the to-do item is
complete, and a creation date.  Note that schemas are just Python dicts. As long as your dictionary
and all its elements are compatible with the built-in <code>json</code> package, your schema will work.
However, this syntax is rather verbose and prone to typo-induced bugs. Therefore the <code>S</code> package
provides a bunch of utility functions that generate schema objects. These functions return plain old
dicts, so there&rsquo;s functionally no difference between the two syntaxes, but the S module is safer:</p>

<pre><code class="language-python">class Item(Document):
    schema = S.object(
        required=['Title'],
        properties=S.props(
            (&quot;title&quot;, S.string(description=&quot;The title of the item&quot;)),
            (&quot;complete&quot;, S.boolean(default=False)),
            (&quot;created&quot;, S.datetime()),
    ))
</code></pre>

<p>That&rsquo;s much shorter! Again, there&rsquo;s no magic to the <code>S.*</code> functions. They&rsquo;re just shorthand and
provide a bit more checking.  It&rsquo;s the same schema as above.  One difference is that the first
example does not enforce any order (except in Python 3.6!) on the dictionary elements.  The version
in the most recent example does, because <code>S.props</code> uses an <code>OrderedDict</code> instead of a plain <code>dict</code>
Now let&rsquo;s see how to get it into a collection and an application, and thus into the database. The
next three classes define the collection (RethinkDB table), application (RethinkDB database), and
the suite (the full group of applications, served on a single tree from a single domain):</p>

<pre><code class="language-python">class Items(Collection):
    document_class = Item  # this is the class that as instances per-record
    indexes = [&quot;title&quot;, &quot;complete&quot;]  # the fields to build indexes on.
    order_by = [&quot;created&quot;]  # Sondra treats &quot;format&quot;: &quot;date-time&quot; as a RethinkDB Date.

class TodoApp(Application):
    collections = (Items,)  # For now we'll just define the collections

class TodoSuite(Suite):
    cross_origin = True  # append CORS headers
    debug = True  # extra logging
</code></pre>

<h3 id="getting-it-into-rethinkdb">Getting it into RethinkDB</h3>

<p>Now that we have all the definitions set up, let&rsquo;s get our data into the database:</p>

<pre><code class="language-python">&gt;&gt;&gt; todo = TodoSuite()
&gt;&gt;&gt; TodoApp(todo)
&gt;&gt;&gt; todo.validate()
&gt;&gt;&gt; todo.ensure_database_objects()

INFO:TodoSuite:Connection established to 'default'
INFO:TodoSuite:Suite base url is: 'http://localhost:5000/api'
INFO:TodoSuite:Docstring processor is {0}
INFO:TodoApp:Registering application todo-app
INFO:TodoSuite:Registered application TodoApp to http://localhost:5000/api/todo-app
INFO:TodoApp:Creating collection for todo-app/items
INFO:TodoSuite:Checking schemas for validity
INFO:TodoSuite:+ todo-app
INFO:TodoSuite:--- items
</code></pre>

<p>The call to <code>todo.ensure_database_objects()</code> creates / ensures the existence of tables and indexes and even
databases for everything that&rsquo;s a part of the suite.  It should always be called once when your
application initializes. At the most basic level, you&rsquo;re now ready to expose your API to your
clients now (we&rsquo;ll handle authentication later), and you can play around with it in Python as well.
In Python, Sondra tries to be as pythonic as possible. All levels of the API are exposed as
dictionary-like objects. The keys are dash-cased versions of the classnames (this can be overridden,
  but is the default).</p>


			<aside class="copyright" role="note">
				
				&copy; 2016 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://jeffersonheard.github.io/sondra/topical-guides/applications/" title="Working with Applications">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Working with Applications
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://jeffersonheard.github.io/sondra/basics/" title="Tutorial">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Tutorial
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/jeffersonheard.github.io\/sondra\/';
      var repo_id  = 'jeffersonheard\/sondra';
    
    </script>

    <script src="https://jeffersonheard.github.io/sondra/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;
            
            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }
        

        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "https://jeffersonheard.github.io/sondra/";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-68674847-2', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
