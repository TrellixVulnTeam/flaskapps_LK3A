<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Adding and Accessing Data - Sondra Documentation</title>
    <meta name="generator" content="Hugo 0.17" />

    
    <meta name="description" content="A framework for creating rich APIs with Python and RethinkDB.">
    
    <link rel="canonical" href="https://jeffersonheard.github.io/sondra/basics/tutorial-4/">
    
    <meta name="author" content="Jefferson Heard">
    

    <meta property="og:url" content="https://jeffersonheard.github.io/sondra/basics/tutorial-4/">
    <meta property="og:title" content="Sondra Documentation">
    <meta property="og:image" content="https://jeffersonheard.github.io/sondra//img/sondra.svg">
    <meta name="apple-mobile-web-app-title" content="Sondra Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://jeffersonheard.github.io/sondra/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://jeffersonheard.github.io/sondra/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://jeffersonheard.github.io/sondra/fonts/icon.eot?52m981');
        src: url('https://jeffersonheard.github.io/sondra/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('https://jeffersonheard.github.io/sondra/fonts/icon.woff?52m981')
               format('woff'),
             url('https://jeffersonheard.github.io/sondra/fonts/icon.ttf?52m981')
               format('truetype'),
             url('https://jeffersonheard.github.io/sondra/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" href="https://jeffersonheard.github.io/sondra/stylesheets/application.css">
    <link rel="stylesheet" href="https://jeffersonheard.github.io/sondra/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://jeffersonheard.github.io/sondra/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://jeffersonheard.github.io/sondra/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://jeffersonheard.github.io/sondra/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-brown palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Adding and Accessing Data
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/jeffersonheard" title="@jeffersonheard on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/jeffersonheard" title="@jeffersonheard on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/jeffersonheard/sondra" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://jeffersonheard.github.io/sondra//img/sondra.svg">
        </div>
      
      <div class="name">
        <strong>Sondra Documentation <span class="version">1.0.0</span></strong>
        
          <br>
          jeffersonheard/sondra
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/jeffersonheard/sondra/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/jeffersonheard/sondra/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introduction" href="https://jeffersonheard.github.io/sondra/">
	
	Introduction
</a>



  
</li>



<li>
  
    <span class="section">Tutorial</span>
    <ul>
      
        
        



<a  title="Your first Sondra API" href="https://jeffersonheard.github.io/sondra/basics/tutorial-1/">
	
	Your first Sondra API
</a>



      
        
        



<a  title="Expose it to the Web" href="https://jeffersonheard.github.io/sondra/basics/tutorial-2/">
	
	Expose it to the Web
</a>



      
        
        



<a  title="Accessing Schemas" href="https://jeffersonheard.github.io/sondra/basics/tutorial-3/">
	
	Accessing Schemas
</a>



      
        
        



<a  title="Adding and Accessing Data" href="https://jeffersonheard.github.io/sondra/basics/tutorial-4/">
	
	Adding and Accessing Data
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Topical Guides</span>
    <ul>
      
        
        



<a  title="Output Formats" href="https://jeffersonheard.github.io/sondra/extending/output-formats/">
	
	Output Formats
</a>



      
        
        



<a  title="Request Processors" href="https://jeffersonheard.github.io/sondra/extending/request-processors/">
	
	Request Processors
</a>



      
        
        



<a  title="The Flask App" href="https://jeffersonheard.github.io/sondra/topical-guides/flask/">
	
	The Flask App
</a>



      
        
        



<a  title="Value Handlers" href="https://jeffersonheard.github.io/sondra/extending/value-handlers/">
	
	Value Handlers
</a>



      
        
        



<a  title="Working with Applications" href="https://jeffersonheard.github.io/sondra/topical-guides/applications/">
	
	Working with Applications
</a>



      
        
        



<a  title="Collections" href="https://jeffersonheard.github.io/sondra/topical-guides/collections/">
	
	Collections
</a>



      
        
        



<a  title="Documents" href="https://jeffersonheard.github.io/sondra/topical-guides/documents/">
	
	Documents
</a>



      
        
        



<a  title="Exposing Methods" href="https://jeffersonheard.github.io/sondra/topical-guides/methods/">
	
	Exposing Methods
</a>



      
        
        



<a  title="The Javascript Client" href="https://jeffersonheard.github.io/sondra/topical-guides/javascript/">
	
	The Javascript Client
</a>



      
        
        



<a  title="Queries over HTTP/S" href="https://jeffersonheard.github.io/sondra/topical-guides/querying/">
	
	Queries over HTTP/S
</a>



      
        
        



<a  title="QuerySets in Python" href="https://jeffersonheard.github.io/sondra/topical-guides/querysets/">
	
	QuerySets in Python
</a>



      
        
        



<a  title="Suites" href="https://jeffersonheard.github.io/sondra/topical-guides/suites/">
	
	Suites
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Extending</span>
    <ul>
      
        
        



<a  title="Document Processors" href="https://jeffersonheard.github.io/sondra/extending/document-processors/">
	
	Document Processors
</a>



      
    </ul>
  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/jeffersonheard" target="_blank" title="@jeffersonheard on Twitter">
              @jeffersonheard on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/jeffersonheard" target="_blank" title="@jeffersonheard on GitHub">
              @jeffersonheard on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:jefferson.r.heard@gmail.com" title="Email of jefferson.r.heard@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Adding and Accessing Data </h1>

			

<h2 id="adding-data-in-python">Adding data in Python</h2>

<p>The simplest way to add data is through Python. Assuming our suite is in an object called
<code>api</code>, this is how we add data:</p>

<pre><code class="language-python">&gt;&gt;&gt; api['todo-app']['items'].create({
...     &quot;title&quot;: &quot;Remember the milk.&quot;,
...     &quot;created&quot;: datetime.utcnow()
... })
&lt;examples.todo.Item object at 0x10f611160&gt;

&gt;&gt;&gt; next(iter(api['todo-app']['items']))
'642478b1-03bb-45e2-9f6d-e90e90d1b7cf'
</code></pre>

<p>The second line demonstrates that Sondra indeed follows the dict pattern closely.  Getting an
iterator over the collection returns a generator that yields keys. This is done via a single
cursor, and is thus very efficient.  You can also use <code>.keys()</code> and <code>.values()</code> and even <code>.items()</code>
as you expect to, yielding primary keys, Document objects, and pairs as they are supposed to.</p>

<pre><code class="language-python">&gt;&gt;&gt; items = api['todo-app']['items']
&gt;&gt;&gt; len(items)
1
&gt;&gt;&gt; items.keys()
KeysView(&lt;examples.todo.Items object at 0x110d40a90&gt;)
&gt;&gt;&gt; items.values()
ValuesView(&lt;examples.todo.Items object at 0x110d40a90&gt;)
&gt;&gt;&gt; items.items()
ItemsView(&lt;examples.todo.Items object at 0x110d40a90&gt;)
&gt;&gt;&gt; '642478b1-03bb-45e2-9f6d-e90e90d1b7cf' in items
True
&gt;&gt;&gt; items['642478b1-03bb-45e2-9f6d-e90e90d1b7cf'] in items
True
&gt;&gt;&gt; first_item = items['642478b1-03bb-45e2-9f6d-e90e90d1b7cf']
&gt;&gt;&gt; first_item
&lt;examples.todo.Item object at 0x10f611160&gt;
&gt;&gt;&gt; first_item.obj
OrderedDict([('complete', False), ('created', '2016-10-13T18:45:08.255000+00:00'),
    ('title', 'Remember the milk.'), ('id', '642478b1-03bb-45e2-9f6d-e90e90d1b7cf')])
&gt;&gt;&gt; first_item == '642478b1-03bb-45e2-9f6d-e90e90d1b7cf'
True
</code></pre>

<p>The last line deserves some explanation. An item is always equal to its primary key, even though we
are really comparing strings and objects. This may be counterintuitive, but it makes for fewer
queries internally and is thus more efficient than the obvious implementation.</p>

<p>Another thing to note is that Sondra takes care to map data to its proper datatype whenever possible.
There&rsquo;s a little &ldquo;magic&rdquo; in this, but it is explained deeper in the documentation.  For example,
let&rsquo;s look at our &ldquo;created&rdquo; attribute:</p>

<pre><code class="language-python">&gt;&gt;&gt; first_item['created']

datetime.datetime(2016, 10, 20, 16, 21, 54, 546629)
</code></pre>

<p>Sondra uses &ldquo;value handlers&rdquo;, found in the <code>sondra.documents.valuehandlers</code> section of the sondra
code to translate between Python datatypes, JSON datatypes, and RethinkDB datatypes. To determine
the datatype, you need look no further than the schema itself. The following shows what schema
attributes  Sondra uses to treat values specially:</p>

<ul>
<li><code>{... &quot;format&quot;: &quot;date-time&quot;}</code> - Handled as a Python datetime, JSON string, RethinkDB date.</li>
<li><code>{... &quot;geo&quot;: true}</code> - Handled as a Python dict-like object (a geometry object if Shapely is installed,
otherwise it will fall back to a dict), JSON object (as GeoJSON geometry), RethinkDB geometry
type.</li>
</ul>

<p>Sondra is compatible with the base datetime library and with <a href="http://crsmithdev.com/arrow/">arrow</a></p>

<h2 id="adding-and-accessing-data-over-http-s">Adding and accessing data over HTTP(S)</h2>

<p>For this section, we&rsquo;re going to assume you will get around to authentication. A basic
authentication and authorization app exists in the Sondra codebase, but you will probably want to
use other, more well-tested frameworks to handle authentication and authorization of web requests in
Flask. This is just fine and well supported. For now, we will assume that a POST will work without
authorization, so you can follow the tutorial without reading extra material.</p>

<p>Sondra is fairly standard when it comes to REST metaphors, but for reference, here is how HTTP
commands map to operations on the API:</p>

<ul>
<li><code>GET</code> - <strong>Retrieve</strong>

<ul>
<li>Retrieve a document,</li>
<li>list of documents, or</li>
<li>make a simple method call</li>
</ul></li>
<li><code>POST</code> - <strong>Add or Replace</strong>

<ul>
<li>Add items to a collection.</li>
<li>Replace an existing document.</li>
<li>Make a more complex method call.</li>
<li>As a special case, you can use JSON to map any of the other commands to a POST. More details in
the source code or the detailed documentation to come.</li>
</ul></li>
<li><code>PUT</code> - <strong>Replace</strong>

<ul>
<li>Replace items in a collection.</li>
<li>Replace an existing document.</li>
</ul></li>
<li><code>PATCH</code> - <strong>Update in Place</strong>

<ul>
<li>Make updates to items in a collection.</li>
<li>Make updates to a single document. (Merges dicts to create updates)</li>
</ul></li>
<li><code>DELETE</code> - <strong>Delete</strong>

<ul>
<li>Delete items from a collection. Delete a single document.</li>
</ul></li>
</ul>

<p>We&rsquo;ll use the Python requests library. By default, Flask exposes itself over port 5000 on localhost,
so that&rsquo;s the assumption we will make. We will also make the assumption that you are <em>not</em> changing
the default api base path, which is simply <code>api</code>.  First, let&rsquo;s get the record we&rsquo;ve already
created:</p>

<pre><code class="language-python">&gt;&gt;&gt; rsp = requests.get('http://localhost:5000/api/todo-app/items')
&gt;&gt;&gt; rsp.json

[{'id': '642478b1-03bb-45e2-9f6d-e90e90d1b7cf', 'complete': False,
  'created': '2016-10-13T18:45:08.255000+00:00', 'title', 'Remember the milk.'}]

&gt;&gt;&gt; requests.get('http://localhost:5000/api/todo-app/items/642478b1-03bb-45e2-9f6d-e90e90d1b7cf').json()

{'id': '642478b1-03bb-45e2-9f6d-e90e90d1b7cf', 'complete': False,
 'created': '2016-10-13T18:45:08.255000+00:00', 'title', 'Remember the milk.'}
</code></pre>

<p>Now how about adding data?  Let&rsquo;s actually use an example in Javascript, since that&rsquo;s how an API
like this will most commonly be used.  Here we&rsquo;re using the &ldquo;fetch&rdquo; API, but you could do the same
with a standard XMLHttpRequest.</p>

<pre><code class="language-Javascript">fetch('http://localhost:5000/api/todo-app/items', {
  method: 'POST',
  mode: 'cors',
  body: JSON.stringify({
    title: 'Remember the cheese',
    complete: false,
    created: new Date()
  })
});
</code></pre>

<h3 id="replace-the-document-on-the-server">Replace the document on the server</h3>

<pre><code class="language-Javascript">fetch('http://localhost:5000/api/todo-app/items/642478b1-03bb-45e2-9f6d-e90e90d1b7cf', {
  method: 'POST',
  mode: 'cors',
  body: JSON.stringify({
    title: 'Remember the milk',
    complete: true,
    created: new Date()
  })
});
</code></pre>

<p>This will actually replace the document with the given ID. If you omit any properties from the
document, they will be omitted in the replacement, since this effectively destroys the old copy and
puts a new one in its place on the database.  What if we just want to say that the item has been
completed?  After all, we don&rsquo;t want to update the &ldquo;created&rdquo; field, since now the data is wrong.</p>

<h3 id="update-properties-on-the-document-on-the-server">Update properties on the document on the server.</h3>

<pre><code class="language-Javascript">fetch('http://localhost:5000/api/todo-app/items/642478b1-03bb-45e2-9f6d-e90e90d1b7cf', {
  method: 'PATCH',
  mode: 'cors',
  body: JSON.stringify({complete: true})
});
</code></pre>

<p>The <code>PATCH</code> method only updates the properties that you give to the request, leaving the others
unchanged.</p>


			<aside class="copyright" role="note">
				
				&copy; 2016 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://jeffersonheard.github.io/sondra/topical-guides/documents/" title="Documents">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Documents
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://jeffersonheard.github.io/sondra/topical-guides/methods/" title="Exposing Methods">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Exposing Methods
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/jeffersonheard.github.io\/sondra\/';
      var repo_id  = 'jeffersonheard\/sondra';
    
    </script>

    <script src="https://jeffersonheard.github.io/sondra/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;
            
            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }
        

        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "https://jeffersonheard.github.io/sondra/";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-68674847-2', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
